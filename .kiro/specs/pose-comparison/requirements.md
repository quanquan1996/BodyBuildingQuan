# 需求文档

## 简介

本文档定义了一个基于 Flutter Web 的姿态对比应用的需求。该应用允许用户上传"标准参考图"和"用户照片"，通过 MediaPipe 提取骨骼关键点，并将参考图的骨架通过数学算法映射到用户图上，形成直观的视觉差异对比。

## 术语表

- **姿态对比应用**: 本 Flutter Web 应用系统
- **参考图**: 用户上传的标准健美造型参考图片
- **用户图**: 用户上传的模仿动作照片
- **姿态关键点**: MediaPipe 检测到的 33 个人体骨骼关键点之一
- **躯干中心**: 由左右肩膀和左右髋部四点平均计算得出的中心点
- **缩放因子**: 用户躯干高度与参考躯干高度的比值
- **幽灵骨架**: 经过对齐和缩放转换后的参考骨架，叠加显示在用户图片上
- **误差向量**: 用户关键点与幽灵关键点之间的差异连线

## 需求列表

### 需求 1: 图像输入功能

**用户故事:** 作为用户，我希望能够上传参考图和我自己的照片，以便对比我的姿态与标准姿态的差异。

#### 验收标准

1. 当用户点击参考图上传区域时，姿态对比应用应打开浏览器文件选择器以允许图片选择。
2. 当用户点击用户图上传区域时，姿态对比应用应打开浏览器文件选择器以允许图片选择。
3. 当图片被选中时，姿态对比应用应在 2 秒内将选中的图片显示在对应的上传区域。
4. 当图片正在加载时，姿态对比应用应在上传区域显示加载指示器。
5. 姿态对比应用应支持拖拽上传图片到对应区域。

### 需求 2: 姿态检测功能

**用户故事:** 作为用户，我希望应用能自动从上传的图片中检测身体姿态，以便查看骨骼结构。

#### 验收标准

1. 当参考图和用户图都上传完成时，姿态对比应用应自动调用姿态检测服务。
2. 当姿态检测被调用时，姿态对比应用应使用 MediaPipe Pose (通过 JavaScript interop) 从每张图片中提取 33 个姿态关键点。
3. 如果图片中未检测到人体，则姿态对比应用应显示错误消息提示姿态检测失败。
4. 当姿态检测正在处理时，姿态对比应用应向用户显示处理指示器。

### 需求 3: 骨架对齐算法

**用户故事:** 作为用户，我希望参考骨架能够对齐并缩放以匹配我的身体比例，以便看到准确的对比效果。

#### 验收标准

1. 当两张图片的姿态检测完成时，姿态对比应用应使用公式计算参考图和用户图的躯干中心：(左肩 + 右肩 + 左髋 + 右髋) / 4。
2. 当躯干中心计算完成时，姿态对比应用应计算缩放因子，即用户躯干高度与参考躯干高度的比值。
3. 当缩放因子计算完成时，姿态对比应用应使用公式转换每个参考姿态关键点：P_ghost = (P_ref - 参考中心) * 缩放因子 + 用户中心。
4. 如果缩放因子计算导致除零错误，则姿态对比应用应使用默认缩放因子 1.0。

### 需求 4: 视觉绘制功能

**用户故事:** 作为用户，我希望在我的照片上看到我的骨架、幽灵骨架和误差向量的叠加显示，以便理解我的姿态与参考姿态的差异。

#### 验收标准

1. 当对齐计算完成时，姿态对比应用应将用户图渲染为背景层。
2. 当渲染叠加层时，姿态对比应用应使用绿色实线（Colors.greenAccent）绘制用户骨架，连接所有主要骨骼关节。
3. 当渲染叠加层时，姿态对比应用应使用半透明青色线条（Colors.cyan，透明度 0.5）绘制幽灵骨架，显示转换后的参考姿态。
4. 当渲染叠加层时，姿态对比应用应使用红色线条（Colors.redAccent）绘制误差向量，连接手腕、手肘和膝盖处的用户关节点与对应的幽灵关节点。
5. 当可视化显示时，姿态对比应用应保持用户图的正确宽高比。

### 需求 5: 用户界面布局

**用户故事:** 作为用户，我希望有一个清晰直观的界面，以便轻松上传图片并查看对比结果。

#### 验收标准

1. 姿态对比应用应在主屏幕上显示两个明确的上传区域，分别标注为"参考图"和"用户图"。
2. 当两张图片都上传并处理完成时，姿态对比应用应在专用结果区域显示对比可视化。
3. 姿态对比应用应提供一个按钮用于重置并开始新的对比。
4. 当查看结果时，姿态对比应用应允许用户缩放和平移对比可视化。
5. 姿态对比应用应采用响应式布局，适配不同浏览器窗口尺寸。
